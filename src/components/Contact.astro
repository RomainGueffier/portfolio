---
import icons from '@tabler/icons'
import Button from './Button.astro'
import Input from './Input.astro'
import Textarea from './Textarea.astro'

const { IconSend } = icons
---

<section id="contact" class="py-20 bg-slate-100 dark:bg-slate-800">
  <div class="w-1/3 mx-auto text-center">
    <h2 class="text-4xl">Contact</h2>
    <form id="contact-form" class="py-10 flex gap-5 flex-col items-center">
      <Input
        type="text"
        placeholder="Fullname"
        name="fullname"
        required
        pattern="[a-zA-Z\\s]+"
        title="Please fill your name with only letters and spaces"
      />
      <Input
        type="email"
        placeholder="Email"
        name="email"
        required
        pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}"
        title="Please enter a valid email address"
      />
      <Input
        type="text"
        placeholder="Telephone"
        name="phone"
        required
        pattern="[0-9\\s]{10,20}"
        title="Please enter a valid phone number"
      />
      <Textarea placeholder="Message" name="message" required />
      <Button
        variant="rounded"
        colorScheme="primary"
        type="submit"
        override="flex gap-2 items-center"
      >
        <IconSend /> Envoyer
      </Button>
    </form>
  </div>
</section>

<script>
  const contactFormEl = document.querySelector('#contact-form')
  if (contactFormEl) {
    contactFormEl.addEventListener('submit', async (event) => {
      event.preventDefault()

      let form = event.currentTarget as HTMLFormElement
      let data = new FormData(form)
      const plainFormData = Object.fromEntries(data.entries())

      const response = await fetch('http://localhost:3000/api/email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Accept: 'application/json',
        },
        body: JSON.stringify(plainFormData),
      })

      const result = await response.json()
      console.log(result)
      form.reset()

      return false
    })
  }
</script>
